<section class="budgets">
  <div class="page-header">
    <div>
      <h2>Budgets</h2>
      <p>Track and manage your spending limits</p>
    </div>
    <button class="btn-primary" (click)="openForm()">+ Create Budget</button>
  </div>

  <div class="overview-cards">
    <div class="overview-card">
      <div class="overview-icon">ğŸ’°</div>
      <div class="overview-content">
        <span class="overview-label">Total Budget</span>
        <h3>{{ totalBudgetLimit | currency: 'PHP':'symbol':'1.2-2' }}</h3>
      </div>
    </div>
    <div class="overview-card">
      <div class="overview-icon">ğŸ’¸</div>
      <div class="overview-content">
        <span class="overview-label">Total Spent</span>
        <h3>{{ totalSpent | currency: 'PHP':'symbol':'1.2-2' }}</h3>
      </div>
    </div>
    <div class="overview-card">
      <div class="overview-icon">ğŸ“Š</div>
      <div class="overview-content">
        <span class="overview-label">Overall Usage</span>
        <h3>{{ overallPercentage | number: '1.0-0' }}%</h3>
      </div>
    </div>
  </div>

  <div class="budgets-grid">
    <div class="budget-card" *ngFor="let budget of budgets" [class]="getStatusClass(budget)">
      <div class="budget-header">
        <div class="budget-title">
          <div class="budget-color" [style.background-color]="budget.color"></div>
          <div>
            <h3>{{ budget.category }}</h3>
            <span class="budget-period">{{ budget.period }}</span>
          </div>
        </div>
        <div class="budget-actions">
          <button class="btn-icon" (click)="openForm(budget)" title="Edit">âœï¸</button>
          <button class="btn-icon" (click)="openDeleteModal(budget)" title="Delete">ğŸ—‘ï¸</button>
        </div>
      </div>

      <div class="budget-amounts">
        <div class="amount-item">
          <span class="amount-label">Spent</span>
          <span class="amount-value spent">{{ budget.spent | currency: 'PHP':'symbol':'1.0-0' }}</span>
        </div>
        <div class="amount-item">
          <span class="amount-label">Limit</span>
          <span class="amount-value">{{ budget.limit_amount | currency: 'PHP':'symbol':'1.0-0' }}</span>
        </div>
      </div>

      <div class="progress-section">
        <div class="progress-header">
          <span class="progress-percentage">{{ getPercentage(budget) | number: '1.0-0' }}%</span>
          <span class="progress-remaining">{{ getRemainingAmount(budget) | currency: 'PHP':'symbol':'1.0-0' }}
            left</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getPercentage(budget)" [style.background-color]="budget.color">
          </div>
        </div>
      </div>

      <div class="budget-status" [ngClass]="getStatusClass(budget)">
        <span *ngIf="getStatusClass(budget) === 'good'">âœ“ On Track</span>
        <span *ngIf="getStatusClass(budget) === 'warning'">âš  Approaching Limit</span>
        <span *ngIf="getStatusClass(budget) === 'over-budget'">â›” Over Budget</span>
      </div>
    </div>

    <div class="empty-state" *ngIf="budgets.length === 0">
      <div class="empty-icon">ğŸ“Š</div>
      <p>No budgets created yet</p>
      <small>Create your first budget to start tracking spending</small>
    </div>
  </div>

  <!-- Budget Form Modal -->
  <div class="modal-overlay" *ngIf="showForm" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ editingId ? 'Edit Budget' : 'Create New Budget' }}</h3>
        <button class="btn-close" (click)="closeForm()">Ã—</button>
      </div>
      <form class="budget-form" (ngSubmit)="saveBudget()">
        <div class="form-group">
          <label for="category">Category</label>
          <select id="category" [(ngModel)]="category" name="category" required [disabled]="editingId !== null">
            <option value="">Select a category</option>
            <option *ngFor="let cat of getAvailableCategories()" [value]="cat">{{ cat }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="limit">Budget Limit (â‚±)</label>
          <input type="number" id="limit" [(ngModel)]="limit" name="limit" min="0" step="0.01" placeholder="0.00"
            required>
        </div>

        <div class="form-group">
          <label for="period">Period</label>
          <select id="period" [(ngModel)]="period" name="period" required>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="closeForm()">Cancel</button>
          <button type="submit" class="btn-primary">{{ editingId ? 'Update' : 'Create' }} Budget</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal-content small" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Confirm Deletion</h3>
        <button class="btn-close" (click)="closeDeleteModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this budget?</p>
        <div class="delete-preview" *ngIf="deletingBudget">
          <strong>{{ deletingBudget.category }}</strong>
          <span>{{ deletingBudget.limit_amount | currency: 'PHP':'symbol':'1.0-0' }}</span>
        </div>
        <p class="warning-text">This action cannot be undone.</p>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button type="button" class="btn-danger" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</section>
